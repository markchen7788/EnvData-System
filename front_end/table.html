<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>商品</title>
	<link rel="stylesheet" href="./layui/css/layui.css">
</head>

<body>
	<script src="./layui/layui.js"></script>
	<script src="./data.js"></script>
	<script src="./func.js"></script>
	<b>
		<form class="layui-form" action="">

			<div class="layui-row">
			    <div class="layui-col-md1">
				<button class="layui-btn" onclick="window.history.back()">返回上一页</button>
				</div>
				<div class="layui-col-md1">
					<input type="text" name="title" required lay-verify="required" placeholder="查询" autocomplete="off"
						class="layui-input">
				</div>
				<div class="layui-col-md3 ">
					<button class="layui-btn " lay-submit lay-filter="formDemo">查询</button>
				</div>
			</div>
		</form>
		<table class="layui-hide" lay-filter="test" id="test"></table>
		<script type="text/html" id="toolbarDemo">
			<div class="layui-btn-container">
			  <button class="layui-btn layui-btn-sm" lay-event="add">手动添加数据</button>
			  <button class="layui-btn layui-btn-sm" lay-event="import">文件导入数据</button>
			  <button class="layui-btn layui-btn-sm" lay-event="chart">生成图表</button>
			  <button class="layui-btn layui-btn-sm" lay-event="multiDelete">批量删除</button>
			</div>
		  </script>
		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		  </script>

		<script>
			//注意：折叠面板 依赖 element 模块，否则无法进行功能性操作

			layui.use(['element', 'table', 'jquery'], function () {
				var element = layui.element;
				var table = layui.table;
				const $ = layui.jquery;
				var form = layui.form;
				form.on('submit(formDemo)', function (data) {
					layer.alert(JSON.stringify(data.field), {
						title: '最终的提交信息'
					})
					return false;
				});
				var tableName = getQueryVariable("tableName");
				var condition = { "tableName": tableName }
				console.log(tableName);
				var data1;
				$.ajax({
					url: 'http://'+hostName+'/test/getTableData',
					type: 'post',
					data: condition,
					success: function (res) {
						console.log(res)
						data1 = res;



						var col = [[{ type: 'checkbox', fixed: 'left' }]], edi = { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150 };
						for (var key in data1[0]) {
							var item = { field: key, title: key, sort: true }
							col[0].push(item)
						}
						col[0].push(edi)

						table.render({
							elem: '#test'
							, data: data1
							, cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
							, toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
							, defaultToolbar: ['filter', 'print', 'exports']
							, cols: col
							, page: true
						});
					}
					//…
				});

				table.on('toolbar(test)', function (obj) {
					var checkStatus = table.checkStatus(obj.config.id);
					switch (obj.event) {
						case 'add':
							layer.msg('手动添加');
							break;
						case 'import':
							layer.msg('导入xls文件');
							break;
						case 'chart':
							layer.open({
								type: 2,
								area: ['1000px', '600px'],
								content: './figure.html' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
							});
							break;
						case 'multiDelete':
							var data = checkStatus.data;
							layer.alert(JSON.stringify(data));
							break;
					};
				});
				table.on('tool(test)', function (obj) {
					var data = obj.data;
					//console.log(obj)
					if (obj.event === 'del') {
						layer.confirm('真的删除行么', function (index) {
							obj.del();
							layer.close(index);
						});
					} else if (obj.event === 'edit') {
						layer.prompt({
							formType: 2
							, value: data.email
						}, function (value, index) {
							obj.update({
								email: value
							});
							layer.close(index);
						});
					}
				});

				//…
			});
		</script>
	</b>
</body>

</html>