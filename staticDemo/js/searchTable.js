//////////测试数据
var colJson = [
	{
		"表名": "宝鸡渭滨区水质监测表",
		"参数名": "Sample ID",
		"数据类型": "varchar",
		"字段注释": "195",
		"主键": "PRI",
		"创建时间": "7/6/2021 00:13:07",
		"注释": "",
		"elementName": "Sample ID",
		"elementUnit": "",
		"dataType": "VARCHAR(100)",
		"elementMemo": "样本Id",
		"tableComment": "宝鸡渭滨区水质监测",
		"siteId": "202104220001",
		"siteName": "宝鸡小陈监测站",
		"area": "陕西省-宝鸡市-渭滨区",
		"comment": "宝鸡小陈监测站最棒了！！！是不是？"
	},
	{
		"表名": "宝鸡渭滨区水质监测表",
		"参数名": "SO₄²ˉ",
		"数据类型": "double",
		"字段注释": "198",
		"主键": "",
		"创建时间": "7/6/2021 00:13:07",
		"注释": "",
		"elementName": "SO₄²ˉ",
		"elementUnit": "ug/cm2",
		"dataType": "DOUBLE",
		"elementMemo": "硫酸根离子",
		"tableComment": "宝鸡渭滨区水质监测",
		"siteId": "202104220001",
		"siteName": "宝鸡小陈监测站",
		"area": "陕西省-宝鸡市-渭滨区",
		"comment": "宝鸡小陈监测站最棒了！！！是不是？"
	},
	{
		"表名": "宝鸡渭滨区水质监测表",
		"参数名": "NO₃ˉ",
		"数据类型": "double",
		"字段注释": "199",
		"主键": "",
		"创建时间": "7/6/2021 00:13:07",
		"注释": "",
		"elementName": "NO₃ˉ",
		"elementUnit": "ug/cm2",
		"dataType": "DOUBLE",
		"elementMemo": "硝酸根离子",
		"tableComment": "宝鸡渭滨区水质监测",
		"siteId": "202104220001",
		"siteName": "宝鸡小陈监测站",
		"area": "陕西省-宝鸡市-渭滨区",
		"comment": "宝鸡小陈监测站最棒了！！！是不是？"
	},
	{
		"表名": "宝鸡渭滨区水质监测表",
		"参数名": "Clˉ",
		"数据类型": "double",
		"字段注释": "201",
		"主键": "",
		"创建时间": "7/6/2021 00:13:07",
		"注释": "",
		"elementName": "Clˉ",
		"elementUnit": "ug/cm2",
		"dataType": "DOUBLE",
		"elementMemo": "氯离子",
		"tableComment": "宝鸡渭滨区水质监测",
		"siteId": "202104220001",
		"siteName": "宝鸡小陈监测站",
		"area": "陕西省-宝鸡市-渭滨区",
		"comment": "宝鸡小陈监测站最棒了！！！是不是？"
	},
	{
		"表名": "宝鸡渭滨区水质监测表",
		"参数名": "Na+",
		"数据类型": "double",
		"字段注释": "217",
		"主键": "",
		"创建时间": "7/6/2021 00:13:07",
		"注释": "",
		"elementName": "Na+",
		"elementUnit": "ug/cm2",
		"dataType": "DOUBLE",
		"elementMemo": "钠离子",
		"tableComment": "宝鸡渭滨区水质监测",
		"siteId": "202104220001",
		"siteName": "宝鸡小陈监测站",
		"area": "陕西省-宝鸡市-渭滨区",
		"comment": "宝鸡小陈监测站最棒了！！！是不是？"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "时间",
		"数据类型": "varchar",
		"字段注释": "197",
		"主键": "PRI",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "时间",
		"elementUnit": "",
		"dataType": "VARCHAR(100)",
		"elementMemo": "时间",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "PM₂.₅",
		"数据类型": "double",
		"字段注释": "204",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "PM₂.₅",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "PM₂.₅微粒",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "PM10",
		"数据类型": "double",
		"字段注释": "211",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "PM10",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "PM10微粒",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "SO2",
		"数据类型": "double",
		"字段注释": "212",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "SO2",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "二氧化硫",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "NO2",
		"数据类型": "double",
		"字段注释": "213",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "NO2",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "二氧化氮",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "CO",
		"数据类型": "double",
		"字段注释": "214",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "CO",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "一氧化碳",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "O3",
		"数据类型": "double",
		"字段注释": "215",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "O3",
		"elementUnit": "μg/m3",
		"dataType": "DOUBLE",
		"elementMemo": "臭氧",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "西安未央气象监测表",
		"参数名": "AQI",
		"数据类型": "double",
		"字段注释": "216",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "AQI",
		"elementUnit": "",
		"dataType": "DOUBLE",
		"elementMemo": "空气质量指数，比值无单位",
		"tableComment": "西安未央气象监测",
		"siteId": "202104220002",
		"siteName": "西安小秦监测站",
		"area": "陕西省-西安市-未央区",
		"comment": "哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "WIN_D",
		"数据类型": "double",
		"字段注释": "206",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "WIN_D",
		"elementUnit": "",
		"dataType": "DOUBLE",
		"elementMemo": "风向",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "WIN_S",
		"数据类型": "double",
		"字段注释": "207",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "WIN_S",
		"elementUnit": "",
		"dataType": "DOUBLE",
		"elementMemo": "风速",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "RHU",
		"数据类型": "double",
		"字段注释": "208",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "RHU",
		"elementUnit": "%",
		"dataType": "DOUBLE",
		"elementMemo": "相对湿度",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "TEM",
		"数据类型": "double",
		"字段注释": "209",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "TEM",
		"elementUnit": "℃",
		"dataType": "DOUBLE",
		"elementMemo": "温度",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "PRS",
		"数据类型": "double",
		"字段注释": "210",
		"主键": "",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "PRS",
		"elementUnit": "Pa",
		"dataType": "DOUBLE",
		"elementMemo": "气压",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	},
	{
		"表名": "铜川耀州气象监测表",
		"参数名": "时间",
		"数据类型": "varchar",
		"字段注释": "197",
		"主键": "PRI",
		"创建时间": "7/6/2021 00:13:08",
		"注释": "",
		"elementName": "时间",
		"elementUnit": "",
		"dataType": "VARCHAR(100)",
		"elementMemo": "时间",
		"tableComment": "铜川耀州气象监测",
		"siteId": "202104220004",
		"siteName": "铜川耀州区小秦监测站",
		"area": "陕西省-铜川市-耀州区",
		"comment": "哈哈哈哈"
	}
];
/////////////////////////
var curArea = [];
layui.use(['element', 'jquery', 'laytpl', 'form', 'laypage'], function () {
	var element = layui.element;
	var laypage = layui.laypage;
	const $ = layui.jquery;
	var laytpl = layui.laytpl;
	var form = layui.form;
	var item = {};
	var count = 0;
	var lim = 10;
	form.on('submit(formDemo)', function (data) {
		// alert(data.field.condition + '&&' + getQueryVariable("area"));
		var con = data.field.condition + '&&' + getQueryVariable("area");
		layer.msg("数据库全字段模糊查询,where条件:" + con);
		return false;
	});
	updateCurrentPage(getQueryVariable("area"), "1");
	function updateCurrentPage(con, page) {
		count = 0;
		form.val("queryForm", { "area": getQueryVariable("area") });
		var condition = { "tableName": "col", "condition": con, "order": "创建时间&&DESC" };
		var load = layer.load({ time: 10 * 1000 });
		var res = colJson;
		item = {};
		for (var i = 0; i < res.length; i++) {
			if (res[i].area.indexOf(con) == -1) continue;
			if (!item.hasOwnProperty(res[i].表名)) {
				item[res[i].表名] = {}
				item[res[i].表名]['表名'] = res[i].表名
				item[res[i].表名]['创建时间'] = dateFormat("YYYY-mm-dd HH:MM:SS", new Date(res[i].创建时间))
				item[res[i].表名]['所在区域'] = res[i].area
				item[res[i].表名]['所属站点'] = res[i].siteName
				item[res[i].表名]['表格备注'] = res[i].tableComment
				item[res[i].表名]['监测元素'] = [];
				count++;
			}
			item[res[i].表名]['监测元素'].push(res[i].参数名);
		}



		////////////////////////////////////分页
		laypage.render({
			elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
			, count: count //数据总数，从服务端得到
			, limit: lim
			, limits: [1, 2, 5, 10, 15, 25, 50]
			, first: '首页'
			, last: '尾页'
			, prev: '上一页'
			, next: '下一页'
			, theme: 'mark'
			, layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
			, jump: function (obj, first) {
				//obj包含了当前分页的所有参数，比如：
				// console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
				// console.log(obj.limit); //得到每页显示的条数

				//首次不执行
				if (!first) {
					//do something
					changePage(obj.curr, obj.limit, item);
				}
			}
		});
		//////////////////////////////////////渲染
		changePage(1, lim, item);
		////////////////////////////////
		layer.close(load);

	}
	function changePage(curr, limit, item) {
		var temp = {}, i = 0, start = (curr - 1) * limit + 1, end = curr * limit;
		for (var key in item) {
			i++;
			//console.log(i)
			if (i >= start && i <= end && i <= count) {
				temp[key] = item[key];
			}

		}
		////////////////////////////////////渲染
		var getTpl = demo.innerHTML;
		laytpl(getTpl).render(temp, function (html) {
			// document.getElementById('allTable').innerHTML= html;
			$("#allTable").html(html);
			element.render('collapse');

		});
	}




});

